const gate = document.getElementById("gate");
const bgm = document.getElementById("bgm");
const introLine = document.getElementById("introLine");

const lines = [
  "「よくぞここまで来たな。(잘 찾아왔구나.)」",
  "「この俺様が、ここにある。俺様が、そなたと共にある。(이 내가 있다. 이 내가 여기에 있다.)」",
  "「故にそなたは、いかなる生においても恐れるものなど何もない。(그러니 너는, 그 어떤 생에서도 두려울 것 따위는 없다.)」"
];

let i = 0;
let timer = null;
let entered = false;


function showLine(text) {
  introLine.textContent = text;
  introLine.classList.remove("out");
  introLine.classList.add("in");

  setTimeout(() => {
    introLine.classList.remove("in");
    introLine.classList.add("out");
  }, 4500); // 6초 중 4.5초쯤부터 사라지기 시작
}

function loopLines() {
  clearInterval(timer);
  showLine(lines[i]);
  i = (i + 1) % lines.length;

  timer = setInterval(() => {
    showLine(lines[i]);
    i = (i + 1) % lines.length;
  }, 6000);
}
loopLines();


bgm.volume = 0.7;


bgm.addEventListener("error", () => {
  console.error("[BGM] audio error", bgm.error);
});

async function tryPlay() {
  try {
    // 로드 강제(가끔 CF에서 preload가 씹힘)
    bgm.load();
    await bgm.play();
    sessionStorage.setItem("bgmAllowed", "1");
    return true;
  } catch (e) {
    console.warn("[BGM] play blocked/fail:", e);
    sessionStorage.setItem("bgmAllowed", "1");
    return false;
  }
}


function armUnlock() {
  tryPlay();
  window.removeEventListener("pointerdown", armUnlock);
  window.removeEventListener("keydown", armUnlock);
}
window.addEventListener("pointerdown", armUnlock, { once: true });
window.addEventListener("keydown", armUnlock, { once: true });

// ===== 한 번 눌러서 상세로 이동 =====
gate.addEventListener("click", async () => {
  if (entered) return;
  entered = true;

  await tryPlay(); 

  // user activation이 남아있는 “즉시” 타이밍에 이동
  location.href = "honemakura.html";
}, { once: true });

